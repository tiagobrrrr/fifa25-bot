{% extends "layout.html" %}

{% block title %}Relat√≥rios - FIFA25 Bot{% endblock %}

{% block content %}
<h2 style="margin-bottom: 20px; color: #2c3e50;">üìà Relat√≥rios e Logs do Scraper</h2>

<div style="margin-bottom: 30px; padding: 20px; background: #ecf0f1; border-radius: 8px;">
    <h3 style="margin-bottom: 15px; color: #2c3e50;">ü§ñ Status do Bot</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <div>
            <strong>Status:</strong> 
            <span class="badge badge-live">ATIVO</span>
        </div>
        <div>
            <strong>Intervalo:</strong> 30 segundos
        </div>
        <div>
            <strong>√öltima execu√ß√£o:</strong>
            {% if logs %}
                {{ logs[0].timestamp.strftime('%d/%m/%Y %H:%M:%S') }}
            {% else %}
                Nunca
            {% endif %}
        </div>
    </div>
</div>

<h3 style="margin-bottom: 15px; color: #2c3e50;">üìù Hist√≥rico de Execu√ß√µes (√öltimas 100)</h3>

<table>
    <thead>
        <tr>
            <th>Data/Hora</th>
            <th>Status</th>
            <th>Partidas Encontradas</th>
            <th>Novas</th>
            <th>Atualizadas</th>
            <th>Tempo (s)</th>
            <th>Mensagem</th>
        </tr>
    </thead>
    <tbody>
        {% if logs %}
            {% for log in logs %}
            <tr>
                <td>{{ log.timestamp.strftime('%d/%m/%Y %H:%M:%S') }}</td>
                <td>
                    {% if log.status == 'success' %}
                        <span class="badge badge-finished">SUCESSO</span>
                    {% elif log.status == 'error' %}
                        <span class="badge badge-live">ERRO</span>
                    {% else %}
                        <span class="badge badge-scheduled">{{ log.status.upper() }}</span>
                    {% endif %}
                </td>
                <td>{{ log.matches_found }}</td>
                <td style="color: #27ae60; font-weight: bold;">{{ log.matches_new }}</td>
                <td style="color: #f39c12; font-weight: bold;">{{ log.matches_updated }}</td>
                <td>{{ "%.2f"|format(log.execution_time) if log.execution_time else '-' }}</td>
                <td>{{ log.message or '-' }}</td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 30px; color: #95a5a6;">
                    Nenhum log registrado ainda
                </td>
            </tr>
        {% endif %}
    </tbody>
</table>

{% if logs %}
<div style="margin-top: 30px; padding: 20px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #27ae60;">
    <h3 style="margin-bottom: 10px; color: #27ae60;">‚úÖ Estat√≠sticas do √öltimo Per√≠odo</h3>
    {% set total_found = logs|sum(attribute='matches_found') %}
    {% set total_new = logs|sum(attribute='matches_new') %}
    {% set total_updated = logs|sum(attribute='matches_updated') %}
    {% set avg_time = (logs|sum(attribute='execution_time') / logs|length) if logs else 0 %}
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
        <div>
            <strong>Total Encontrado:</strong> {{ total_found }}
        </div>
        <div>
            <strong>Total Novas:</strong> {{ total_new }}
        </div>
        <div>
            <strong>Total Atualizadas:</strong> {{ total_updated }}
        </div>
        <div>
            <strong>Tempo M√©dio:</strong> {{ "%.2f"|format(avg_time) }}s
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Auto-refresh a cada 60 segundos
    setTimeout(function() {
        location.reload();
    }, 60000);
</script>
{% endblock %}